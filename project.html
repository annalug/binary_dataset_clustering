<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitetura - Siamese Network para Similaridade de Datasets</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 2rem;
            color: #e0e0e0;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00d9ff;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 20px rgba(0, 217, 255, 0.3);
        }
        
        .subtitle {
            text-align: center;
            color: #8892b0;
            font-size: 1rem;
            margin-bottom: 2rem;
        }
        
        .diagram-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .diagram-section h2 {
            color: #64ffda;
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid rgba(100, 255, 218, 0.3);
        }
        
        .mermaid {
            display: flex;
            justify-content: center;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
        }
        
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .legend-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.2rem;
            border-left: 4px solid;
        }
        
        .legend-item.loader { border-color: #ff6b6b; }
        .legend-item.standardizer { border-color: #ffd93d; }
        .legend-item.siamese { border-color: #6bcb77; }
        .legend-item.ranking { border-color: #4d96ff; }
        
        .legend-item h3 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .legend-item.loader h3 { color: #ff6b6b; }
        .legend-item.standardizer h3 { color: #ffd93d; }
        .legend-item.siamese h3 { color: #6bcb77; }
        .legend-item.ranking h3 { color: #4d96ff; }
        
        .legend-item p {
            font-size: 0.9rem;
            color: #a0a0a0;
            line-height: 1.5;
        }
        
        .legend-item code {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.8rem;
            color: #00d9ff;
        }
        
        .architecture-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1rem;
        }
        
        @media (max-width: 900px) {
            .architecture-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .info-box {
            background: linear-gradient(135deg, rgba(100, 255, 218, 0.1), rgba(0, 217, 255, 0.05));
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .info-box h3 {
            color: #64ffda;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .info-box ul {
            list-style: none;
            padding-left: 0;
        }
        
        .info-box li {
            padding: 0.4rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: #b0b0b0;
        }
        
        .info-box li::before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: #64ffda;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Siamese Network para Similaridade de Datasets</h1>
        <p class="subtitle">Sistema de ranking de similaridade entre datasets de malware Android</p>
        
        <!-- Pipeline Principal -->
        <div class="diagram-section">
            <h2>üìä Pipeline Principal</h2>
            <div class="mermaid">
flowchart LR
    subgraph INPUT["üìÅ Entrada"]
        A[("./data/<br>CSVs")]
    end
    
    subgraph LOAD["üîÑ Carregamento"]
        B["dataset_loader.py<br><small>load_datasets_from_folder()</small>"]
    end
    
    subgraph STANDARD["‚öôÔ∏è Padroniza√ß√£o"]
        C["standardizer.py<br><small>DatasetStandardizer</small>"]
        C1["PCA Local"]
        C2["Pad/Sample"]
    end
    
    subgraph SIAMESE["üß† Rede Siamesa"]
        D["siamese.py<br><small>SiameseNet</small>"]
        D1["Encoder CNN"]
        D2["Embeddings<br>128-dim"]
    end
    
    subgraph RANK["üìà Ranking"]
        E["ranking.py<br><small>rank_similar_datasets()</small>"]
        E1["Cosine<br>Similarity"]
    end
    
    subgraph OUTPUT["üéØ Sa√≠da"]
        F[("Ranking<br>Ordenado")]
    end
    
    A --> B
    B -->|"List[np.ndarray]<br>(n, features)"| C
    C --> C1 & C2
    C1 & C2 -->|"(256, 100, 1)"| D
    D --> D1 --> D2
    D2 -->|"(128,)"| E
    E --> E1
    E1 --> F
    
    style INPUT fill:#2d3436,stroke:#ff6b6b,color:#fff
    style LOAD fill:#2d3436,stroke:#ff6b6b,color:#fff
    style STANDARD fill:#2d3436,stroke:#ffd93d,color:#fff
    style SIAMESE fill:#2d3436,stroke:#6bcb77,color:#fff
    style RANK fill:#2d3436,stroke:#4d96ff,color:#fff
    style OUTPUT fill:#2d3436,stroke:#4d96ff,color:#fff
            </div>
        </div>
        
        <!-- Arquitetura da CNN -->
        <div class="diagram-section">
            <h2>üß† Arquitetura do Encoder CNN (Default)</h2>
            <div class="architecture-grid">
                <div class="mermaid">
flowchart TB
    subgraph ENCODER["Encoder Compartilhado"]
        I["Input<br>(256, 100, 1)"] --> B1
        
        subgraph B1["Bloco 1"]
            C1["Conv2D 32<br>3√ó3, ReLU"]
            BN1["BatchNorm"]
            MP1["MaxPool 2√ó2"]
            DR1["Dropout 0.25"]
            C1 --> BN1 --> MP1 --> DR1
        end
        
        B1 --> B2
        
        subgraph B2["Bloco 2"]
            C2["Conv2D 64<br>3√ó3, ReLU"]
            BN2["BatchNorm"]
            MP2["MaxPool 2√ó2"]
            DR2["Dropout 0.25"]
            C2 --> BN2 --> MP2 --> DR2
        end
        
        B2 --> B3
        
        subgraph B3["Bloco 3"]
            C3["Conv2D 128<br>3√ó3, ReLU"]
            BN3["BatchNorm"]
            MP3["MaxPool 2√ó2"]
            DR3["Dropout 0.3"]
            C3 --> BN3 --> MP3 --> DR3
        end
        
        B3 --> FL["Flatten"]
        FL --> D1["Dense 256<br>ReLU"]
        D1 --> BN4["BatchNorm"]
        BN4 --> DR4["Dropout 0.4"]
        DR4 --> EMB["Dense 128<br>Embedding"]
        EMB --> L2["L2 Normalize"]
    end
    
    style ENCODER fill:#1a1a2e,stroke:#6bcb77,color:#fff
    style B1 fill:#2d3436,stroke:#64ffda,color:#fff
    style B2 fill:#2d3436,stroke:#64ffda,color:#fff
    style B3 fill:#2d3436,stroke:#64ffda,color:#fff
                </div>
                
                <div class="mermaid">
flowchart TB
    subgraph SIAMESE["Rede Siamesa Completa"]
        DL["Dataset Left<br>(256, 100, 1)"]
        DR["Dataset Right<br>(256, 100, 1)"]
        
        DL --> ENC1["Encoder<br>(compartilhado)"]
        DR --> ENC2["Encoder<br>(compartilhado)"]
        
        ENC1 --> EL["Embedding L<br>(128,)"]
        ENC2 --> ER["Embedding R<br>(128,)"]
        
        EL --> DIST
        ER --> DIST
        
        DIST["Dist√¢ncia<br>Euclidiana"]
        DIST --> SIM["Dense 1<br>Sigmoid"]
        SIM --> OUT["Similaridade<br>[0, 1]"]
    end
    
    style SIAMESE fill:#1a1a2e,stroke:#6bcb77,color:#fff
    style ENC1 fill:#2d3436,stroke:#ffd93d,color:#fff
    style ENC2 fill:#2d3436,stroke:#ffd93d,color:#fff
                </div>
            </div>
        </div>
        
        <!-- Processo de Padroniza√ß√£o -->
        <div class="diagram-section">
            <h2>‚öôÔ∏è Processo de Padroniza√ß√£o (DatasetStandardizer)</h2>
            <div class="mermaid">
flowchart LR
    subgraph INPUT["Dataset Original"]
        A["(n_samples, n_features)<br>Ex: (5000, 2500)"]
    end
    
    subgraph SAMPLES["1. Padroniza Amostras"]
        B1{"n > 256?"}
        B2["Subamostra<br>aleat√≥ria"]
        B3["Padding<br>com zeros"]
        B1 -->|Sim| B2
        B1 -->|N√£o| B3
    end
    
    subgraph FEATURES["2. Padroniza Features"]
        C1{"n > 100?"}
        C2["PCA Local<br>100 componentes"]
        C3["Padding<br>com zeros"]
        C1 -->|Sim| C2
        C1 -->|N√£o| C3
        C2 --> C4["Re-binariza<br>(> 0.5)"]
    end
    
    subgraph OUTPUT["Dataset Padronizado"]
        D["(256, 100, 1)"]
    end
    
    A --> B1
    B2 --> C1
    B3 --> C1
    C3 --> D
    C4 --> D
    
    style INPUT fill:#2d3436,stroke:#ff6b6b,color:#fff
    style SAMPLES fill:#2d3436,stroke:#ffd93d,color:#fff
    style FEATURES fill:#2d3436,stroke:#ffd93d,color:#fff
    style OUTPUT fill:#2d3436,stroke:#6bcb77,color:#fff
            </div>
            
            <div class="info-box">
                <h3>üí° Por que padroniza√ß√£o independente?</h3>
                <ul>
                    <li>Cada dataset representa uma "fam√≠lia" ou configura√ß√£o de malware diferente</li>
                    <li>PCA compartilhado distorceria as caracter√≠sticas individuais de cada dataset</li>
                    <li>A similaridade deve ser entre as estruturas originais, n√£o artefatos de preprocessamento</li>
                    <li>Mant√©m a sem√¢ntica dos dados bin√°rios ap√≥s transforma√ß√£o</li>
                </ul>
            </div>
        </div>
        
        <!-- Legenda dos M√≥dulos -->
        <div class="diagram-section">
            <h2>üì¶ Descri√ß√£o dos M√≥dulos</h2>
            <div class="legend">
                <div class="legend-item loader">
                    <h3>dataset_loader.py</h3>
                    <p>Carrega CSVs bin√°rios de uma pasta, separando features <code>X</code> e r√≥tulos <code>y</code>. Garante binaridade com <code>np.clip(0,1)</code>.</p>
                </div>
                
                <div class="legend-item standardizer">
                    <h3>standardizer.py</h3>
                    <p>Normaliza datasets para shape fixo <code>(256, 100, 1)</code>. Usa PCA local independente por dataset para manter caracter√≠sticas √∫nicas.</p>
                </div>
                
                <div class="legend-item siamese">
                    <h3>siamese.py</h3>
                    <p>Rede Siamesa com CNN compartilhado. Gera embeddings de 128-dim normalizados L2. Treina com pares similar/diferente.</p>
                </div>
                
                <div class="legend-item ranking">
                    <h3>ranking.py</h3>
                    <p>Calcula similaridade de cosseno entre embeddings e retorna ranking ordenado por proximidade ao dataset query.</p>
                </div>
            </div>
        </div>
        
        <!-- Fluxo de Dados -->
        <div class="diagram-section">
            <h2>üîÑ Transforma√ß√£o de Dados</h2>
            <div class="mermaid">
flowchart TB
    subgraph SHAPES["Transforma√ß√£o de Shapes"]
        S1["üìÑ CSV Raw<br><small>(vari√°vel √ó vari√°vel)</small>"]
        S2["üìä Loaded<br><small>(n_samples, n_features)</small>"]
        S3["üìê Standardized<br><small>(256, 100, 1)</small>"]
        S4["üéØ Embedding<br><small>(128,)</small>"]
        S5["üìà Similarity<br><small>float [0,1]</small>"]
        
        S1 -->|"pd.read_csv()"| S2
        S2 -->|"fit_transform()"| S3
        S3 -->|"get_embedding()"| S4
        S4 -->|"cosine_similarity()"| S5
    end
    
    style SHAPES fill:#1a1a2e,stroke:#64ffda,color:#fff
            </div>
        </div>
    </div>
    
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#64ffda',
                primaryTextColor: '#fff',
                primaryBorderColor: '#64ffda',
                lineColor: '#8892b0',
                secondaryColor: '#2d3436',
                tertiaryColor: '#1a1a2e',
                background: '#1a1a2e',
                mainBkg: '#2d3436',
                nodeBorder: '#64ffda',
                clusterBkg: '#16213e',
                clusterBorder: '#64ffda',
                titleColor: '#64ffda',
                edgeLabelBackground: '#1a1a2e'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>